---
layout: post
title: "开源世界旅行手册：核心工具集(二)"
date:  2020-01-03 10:28:00
author: "Viletyy"
header-style: text
tags:
  - Linux
---
## 核心工具集（二）

### 细节

一个文件主要包含下列属性，`ls -l`

```shell
- rwx①rwx②rwx③ user④ group⑤ date⑥ filename⑦
  111 101 101
```

① 归属用户的权限

② 归属群组的权限

③ 其他用户的权限

④ 归属用户

⑤ 归属群组

⑥ 日期信息

⑦ 文件名称

- 对于文件夹，必须拥有它的可执行权限，才能够使用cd命令进入该文件夹；拥有可读权限，才能够使用ls命令查看该文件夹的文件列表
- root用户 拥有最高权限

可以使用3位的二进制数字来描述一组权限，某一权限对应的数字为1，则表示具有该种权限，为0，则不具有该种权限。

使用二进制数字来描述一组权限，虽然非常直观，但是3组权限需要用9位数来表示，不够方便。因此我门将三组权限使用3位8进制数字来表示

每种权限对应的数字：

| 权限   | r    | w    | x    |
| ------ | ---- | ---- | ---- |
| 二进制 | 100  | 010  | 001  |
| 八进制 | 4    | 2    | 1    |

将这3位8进制数字相加的结果，就可以表示该组权限的具体内容，例如：

还可以使用a、u、g、o表示归属关系，使用=、+、-表示权限变化，使用r、w、x表示权限内容

a 所有用户 u 归属用户 g 归属群组 o 其他用户

= 具有权限 + 增加权限 - 去除权限

r 可读权限 w 可写权限 x 可执行权限

例如：

```shell
a+x 给所有用户增加可执行权限
go-wx 将归属群组和其他用户的可写、可执行权限去掉
u=rwx 归属用户 具有可读、可写、可执行权限
```

### chmod 权限表达式 文件｜目录

更改文件的权限。权限的表达式可以使用3位8进制数字表示，或者使用augo +-=rxw-s 来表示

| 参数                       | 含义                     |
| -------------------------- | ------------------------ |
| -R                         | 递归                     |
| -v                         | 显示过程                 |
| -c                         | 类似“-v”，仅显示更改部分 |
| --reference=参照文件或目录 | 以指定文件为参照更改权限 |

示例：

```shell
chmod -R a+x path 
chmod -Rv 755 path
```

### chown 归属[:归属群组] 文件｜目录

更改文件的归属用户。可以使用用户名或者用户编号

| 参数                       | 含义                     |
| -------------------------- | ------------------------ |
| -R                         | 递归                     |
| -v                         | 显示过程                 |
| -c                         | 类似“-v”，仅显示更改部分 |
| --reference=参照文件或目录 | 以指定文件为参照更改权限 |

示例：

```shell
chown user:admin path 
chown -R user.admin path 
chown user path
```

### chgrp 归属群组 文件｜目录

更改文件的归属群组。可以使用群组名或者群组编号，选项同上

### SUID、SGID、Sticky bit

某些情况下，需要以可执行文件归属用户的身份执行该文件，可以为该文件设置SUID。同样，设置SGID能够以该文件归属群组的身份执行它。

例如：用户自行设定密码。出于安全方面的考虑，/etc/shadow 只能由root用户直接修改

```shell
-rw------- root root /etc/shadow
```

这个时候，可以为程序 /usr/bin/passwd 设置SUID，当普通用户执行`passwd`命令时，便能够以该程序归属用户root的身份修改 /etc/shadow文件，而 passwd程序自身带有身份验证机制，不能通过验证时拒绝执行，从而保证了安全。

```shell
ls -l /usr/bin/passwd 
-r-s--x--x root root /usr/bin/passwd
```

我们发现，归属用户的可执行权限位使用 `s`表示SUID。同样，归属群组的可执行权限位使用`s`，表示SGID。任何用户或群组都拥有“其他用户”的权限，所以不需要以其他用户身份执行文件，其他用户的可执行权限位便不会出现`s`。该权限位可能出现的属性为`t`。也就是粘着位Sticky bit。

```shell
ls -ld /tmp
drwxrwxrwt root root /tmp
```

粘着位表示任何用户都可能具有写权限，但只有该归属用户或root用户才能够删除。

SUID、SGID、Sticky bit也可以像权限一样使用一个八进制数表示，如下

| 八进制数 | 含义       |
| -------- | ---------- |
| 4        | SUID       |
| 2        | SGID       |
| 1        | Sticky bit |

通过在`chmod`命令中使用4个八进制数的表达式，如4755，用第一位表示SUID、SGID或Sticky bit，便能够为文件设置这些特殊权限。示例：

```shell
chmod -R 4755 path
```

### lsattr [路径]

查看文件的特殊属性

| 参数 | 含义       |
| ---- | ---------- |
| -a   | 全部显示   |
| -d   | 只显示目录 |
| -R   | 递归       |

特殊属性包括：

| 参数 | 含义                   |
| ---- | ---------------------- |
| a    | 仅供附加用途           |
| b    | 不更新最后存取世界     |
| c    | 压缩后存放             |
| d    | 排除在转储操作之外     |
| i    | 不得任意更动文件或目录 |
| s    | 保密性删除文件或目录   |
| S    | 即时更新文件或目录     |
| u    | 预防意外删除           |

### chattr +|-|=属性 路径

更改文件特殊属性

| 参数 | 含义     |
| ---- | -------- |
| -R   | 递归     |
| -V   | 显示过程 |



参考资料：

- [开源世界旅行手册](https://i.linuxtoy.org/docs/guide/)