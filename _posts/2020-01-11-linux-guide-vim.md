---
layout: post
title: "开源世界旅行手册：Vim编辑器（一）"
date: 2020-01-10 10:28:00
author: "Viletyy"
header-style: text
tags:
  - Linux
---
## Vim编辑器（一）

### Vim简介

我们使用的大多数编辑器，都可以直接在编辑区输入字符，并且能够通过一些快捷键来完成一些控制功能，比如使用方向键移动光标，使用BackSpace或者Delete键删除文字，使用PgUp和PgDn翻页，使用Home和End来定位首和行末......

而Vim是一个带模式的编辑器，同样的按键，在不同的模式下，具有不同的功能定义。例如h j k l 在编辑模式下输入相应的字符，在普通模式下却相当于方向键的作用。

由于需要切换模式，Vim的使用起来略显繁琐，不过优点也显而易见：您吱哟啊把手安安稳稳的放在打字区就可以了，而不需要使用诸如方向键、排版键、小键盘等需要挪开双手的健伟，从而提高了您的效率和专注程度。事实上，Vim的前身Vi诞生的时候，键盘上还没有方向键、排版键和小键盘。

### 命令

使用Vim编辑文件：

```shell
vi [文件名]
vim [文件名]
```

教学模式：

```shell
vimtutor [语言]
```

vim教程，相当于使用Vim编辑器以只读模式打开教程文件。您无论对这个文件做了什么，都会在退出后恢复原来的样貌。与只读模式的区别在于，它不会没有眼色的提醒您，现在的状态为只读模式。您可以使用它做一些练习。

您可以指定教程文件的语言，如果使用本地语言(ZH_cn)出现乱码，您可以尝试使用英语

```shell
vimtutor en
```

使用Vim比较文件区别

```shell
vimdiff [文件1] [文件2] [其他文件] ...... 
```

### 配置文件

Vim的全局配置文件为/etc/vim/vimrc，用户配置文件为～/.vimrc，"起始的行为注释行。我们提供的配置项，您直接加入配置文件就可以了

您可以先对Vim进行一些简单的配置：

**Vim配置/etc/vim/vimrc**

```
"运行在非兼容(VI)模式下(命令模式下 TAB 补全)
set nocompatible

"设定文件编码
set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936

"开启语法加亮
syntax on
"配色风格
colorscheme pablo

"简洁启动模式
set shortmess=atI
"设定 GUI 选项
"set guioptions=gmrLtT  m:菜单 T:工具栏
set guioptions=gmrLt
"命令行高度
set cmdheight=1
"设定行距 ( GUI 界面中生效 )
set linespace=4
"显示标尺
set ruler

"自动折行
"set nowrap
set wrap
"按完整单词折行
set nolinebreak
"set linebreak
"行宽（输入时自动插入换行符）
"set textwidth=80
set textwidth=0

"允许在 虚空间 内操作 （虚空间:不包含任何文本的空间。如换行符之后）
"set virtualedit=all
"禁止在 虚空间 内操作
set virtualedit=

"设定 Tab 键缩进的空格数
set tabstop=4
"设定编辑器将多少空格视为一个缩进
set shiftwidth=4
"将缩进转换为空格
"set expandtab
"设定自动缩进(新行与前一行缩进相同)
set autoindent
"set noautoindent
"插入模式下，“←”如何删除光标前的字符：行首空白、换行符、插入点之前的字符
set backspace=indent,eol,start

"命令行历史纪录
set history=500

"禁用增量搜索
set incsearch
"set noincsearch
"搜索时忽略大小写
set ignorecase
"set noignorecase
"高亮显示搜索结果
set hlsearch

"设定折叠方式
"set foldmethod=manual

"以下字符将被视为单词的一部分 (ASCII)：
"set iskeyword+=33-47,58-64,91-96,123-128
```



#### 模式行

也可以通过"模式行"将配置选项嵌入在普通文件中。打开此文件时，优先使用模式行中的配置：

```shell
# vim: filetype=sh foldmethod=marker autoindent expandtab shiftwidth=4
模式行可以写在任意位置
但为了不影响文件功能，模式行通常写在注释中
模式行以 vim: 起始，前面至少要有一个空白字符（空格、换行符等）
模式行中的设置项以空格分隔
......
```

这种形式的缺点在于，不能在设置项后添加其他文本。如果有相关需要，可以使用另一种模式行：

```shell
<!-- vim:set filetype=html: 这里可以任意添加文本 -->
```

### 模式介绍

Vim常见的模式有：**普通模式**、**插入模式**、**命令模式**，另外我们也会经常用到 **可视模式**。

Vim启动时进入普通模式；或者在其他模式下，按下Esc键，便可以回到普通模式。

使用vimtutor en命令进入教程，现在是普通模式。随便按几下j、k、l、h，您会发现光标的位置发生改变。

按下i键，编辑器底部出现了--插入--或者--insert--，您进入了插入模式。随便按几下j、k、l、h，您会发现相应的字符出现在编辑去，现在还可以通过方向键来移动光标，可能您觉得使用方向键移动光标不是什么问题，但是习惯了Vim后，您反而会认为方向键太麻烦了，简直不能容忍！好了，现在按下Esc回到普通模式，我们又可以使用j、k、l、h来移动光标了。

在普通模式下，按下：键（也就是shift+；），在编辑器底部出现了一个：，您进入了命令模式，在：后输入一个命令new，回车后，编辑器被分割为上下两栏。为了方便起见，我们在命令前价一个：来表示命令模式下输入的命令，像这样：

```shell
:vnew
```

命令能够以一些规则简化，上面的命令也可以写为这种形式

```shell
:vne
```

现在您的编辑区一定弄的四分五裂，您可以使用命令 **:quit** 来关闭当前栏，直接用简写就可以了

```shell
:q
```

这个命令是退出编辑器，如果编辑区被分成多栏，则是退出当前栏。

执行完一个个命令（按下回车后）编辑器会自动回到普通模式。如果想不执行当前命令，直接回到普通模式，您可以按下Esc键。

按下v键，您进入了可视模式，可以使用j、k、l、h移动光标，高亮选取文本。

事实上，可视模式相当于高亮选取文本后的普通模式。

可视模式具有多种模式，以行为单位进行选取的可视行模式，使用v键进入（也就是Shif+v）；和以块为单位进行选取的可视块模式，使用Ctrl+v键进入。

### 模式切换

| 切换前   | 切换后   | 按键                 |
| -------- | -------- | -------------------- |
| 其他模式 | 普通模式 | Esc                  |
| 普通模式 | 插入模式 | i 在光标前插入       |
|          |          | I 在行首插入         |
|          |          | a 在光标后插入       |
|          |          | A 在行末插入         |
|          |          | o 在当前行下新建行   |
|          |          | O 在当前行上新建行   |
|          |          | r 替换当前字符       |
|          |          | R 从当前字符开始替换 |
| 普通模式 | 命令模式 | :                    |
| 普通模式 | 可视模式 | v 可视模式           |
|          |          | V 可视行模式         |
|          |          | Ctrl+v 可视块模式    |

### 移动

在普通模式中您可以使用以下方式移动光标

|       |       |       |
| ----- | ----- | ----- |
|       | k(上) |       |
| h(左) |       | l(右) |
|       | j(下) |       |

您可以使用其他更有效率的方式移动光标

|                        | 向前 | 向后 |
| ---------------------- | ---- | ---- |
| 单词                   | w    | b    |
| 单词，包括特殊符号     | W    | B    |
| 单词词尾               | e    |      |
| 单词词尾，包括特殊符号 | E    |      |
| 行                     | 0    | $    |
| 行首文字（不包括空格） | ^    |      |
| 页                     | H    | L    |
| 页面中部               | M    |      |

在其他模式中，您可以使用方向键移动光标，不过那样比较麻烦，您可以在配置文件中绑定插入模式下的功能键

```shell
noremap! <M-j> <Down>
noremap! <M-k> <Up>
noremap! <M-h> <Left>
noremap! <M-l> <Right>
......
作用范围 键位 功能
```

> 其中，map! 绑定的键盘映射，作用于所有模式； inoremap! 绑定的映射，仅作用于插入模式

### 数字参数

您也可以使用数字参数（普通模式），来重复执行。例如

```shell
100j
```

执行100次j键，向下100行

### 浏览

|                            | 向前     | 向后   |
| -------------------------- | -------- | ------ |
| 整页                       | Ctrl+f   | Ctrl+b |
| 半页                       | Ctrl+d   | Ctrl+u |
| 文件                       | G        | gg     |
| 按行号转到相应行           | 行号G    |        |
| 按百分比转到相应行         | 1～100%  |        |
| 按行卷动                   | Ctrl+e   | Ctrl+y |
| 将光标所在行调整至页面中间 | zz       |        |
| 统计字数                   | g Ctrl+g |        |
| 显示位置信息               | Ctrl+g   |        |
| 刷新屏幕                   | Ctrl+l   |        |

> gg定位到文件首行，v进入可视行模式，G定位到文件末行，实现类似“全选”的功能。依次按下g g V(Shif+v) G(Shift+g)

### 标记

您可以在当前光标处做一个标记，以便快速返回

```
m标记名称 定义标记，标记名称为一个字符
`标记名称 返回标记

mx	将当前光标处定义为标记x
`x 返回标记x

:marks 查看标记列表
```

### 编辑

|      | 复制                    | 剪切 |
| ---- | ----------------------- | ---- |
| 字符 | y(需要在可视模式中选取) | x    |
| 行   | yy                      | dd   |



| 按键   | 含义               |
| ------ | ------------------ |
| p      | 在光标后粘贴       |
| P      | 在光标前粘贴       |
| u      | 撤销               |
| Ctrl+r | 重做               |
| Ctrl+y | 逐字克隆上一行内容 |
| Ctrl+e | 逐字克隆下一行内容 |




参考资料：

- [开源世界旅行手册](https://i.linuxtoy.org/docs/guide/)
